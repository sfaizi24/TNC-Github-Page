<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>TNC The Model™ V2 Week 13 Predictions</title>
    <!-- Use Apple System Fonts -->
    <style>
        /* Reset CSS */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background-color: #FFFFFF;
            color: #1D1D1F;
            line-height: 1.6;
            padding: 20px;
        }

        h1,
        h2 {
            font-weight: 600;
        }

        h1 {
            font-size: 36px;
            text-align: center;
            margin-bottom: 40px;
        }

        /* Navigation Tabs */
        .tab-container {
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #E0E0E0;
            margin-bottom: 30px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 18px;
            color: #6E6E73;
            transition: color 0.3s, border-bottom 0.3s;
        }

        .tab:hover {
            color: #0071E3;
        }

        .tab.active {
            color: #0071E3;
            border-bottom: 2px solid #0071E3;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Styles */
        .form-group {
            max-width: 600px;
            margin: 0 auto 20px;
        }

        label {
            display: block;
            font-size: 17px;
            margin-bottom: 10px;
        }

        select,
        input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 17px;
            border: 1px solid #D2D2D7;
            border-radius: 12px;
            background-color: #F5F5F7;
            outline: none;
            appearance: none;
            margin-bottom: 20px;
        }

        select:focus,
        input[type="number"]:focus {
            border-color: #0071E3;
        }

        button {
            display: block;
            width: 100%;
            max-width: 200px;
            margin: 30px auto;
            padding: 15px 20px;
            font-size: 17px;
            font-weight: 600;
            color: #FFFFFF;
            background-color: #0071E3;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #005BB5;
        }

        /* Result Display */
        #result {
            margin-top: 40px;
            font-size: 28px;
            font-weight: 600;
            text-align: center;
        }

        /* Chart Styles */
        #playerChartContainer,
        #varianceChartContainer,
        #weeksAboveChartContainer {
            max-width: 1000px;
            margin: 50px auto;
        }

        #playerChart,
        #varianceChart,
        #weeksAboveChart {
            width: 100%;
            height: 500px;
        }

        /* Content Sections */
        .content-section {
            max-width: 800px;
            margin: 0 auto;
            font-size: 17px;
        }

        .content-section h2 {
            font-size: 28px;
            margin-bottom: 20px;
        }

        .content-section p {
            margin-bottom: 20px;
        }

        .content-section ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        .content-section ul li {
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
            }

            .tab {
                font-size: 16px;
                padding: 12px 15px;
            }

            button {
                width: 90%;
            }

            #result {
                font-size: 24px;
            }

            #playerChart,
            #varianceChart,
            #weeksAboveChart {
                height: 300px;
                /* Adjust height for smaller screens */
            }
        }
    </style>
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <h1>TNC The Model™ V2 Week 13 Predictions</h1>

    <!-- Tab navigation -->
    <div class="tab-container">
        <div class="tab active" onclick="switchTab('chartTab')">Prediction Model and Charts</div>
        <div class="tab" onclick="switchTab('bulletTab')">Roster Changes</div>
        <div class="tab" onclick="switchTab('explanationTab')">How The Model Works</div>
    </div>

    <!-- Tab content -->
    <div id="chartTab" class="tab-content active">
        <div class="form-group">
            <label for="teamA">Select Winning Team:</label>
            <select id="teamA">
                <option value="">-- Select a Team --</option>
            </select>
        </div>

        <div class="form-group">
            <label for="teamB">Select Losing Team:</label>
            <select id="teamB">
                <option value="">-- Select a Team --</option>
            </select>
        </div>

        <div class="form-group">
            <label for="adjustment">Win By (optional):</label>
            <input type="number" id="adjustment" step="any" placeholder="Enter point difference">
        </div>

        <button onclick="calculateProbability()">Calculate</button>

        <h2 id="result"></h2>

        <!-- Existing chart container -->
        <div id="playerChartContainer">
            <canvas id="playerChart"></canvas>
        </div>

        <!-- Variance vs Expected Points chart container -->
        <div id="varianceChartContainer">
            <canvas id="varianceChart"></canvas>
        </div>

        <!-- Weeks Above Projection chart container -->
        <div id="weeksAboveChartContainer">
            <canvas id="weeksAboveChart"></canvas>
        </div>
    </div>

    <div id="bulletTab" class="tab-content">
        <div class="content-section">
            <h2>Assumptions Made</h2>
            <ul>
                <li><strong>Projection Data taken from Wednesday, Nov 27th snapshot.</strong></li>
                <li>Mehdi has JK Dobbins out.</li>
                <li>Sumedh gets Pacheco back.</li>
                <li>Umar gets a new TE and Kicker.</li>
                <li>Dany starts Burrow and Davante.</li>
                <li>Samer has Josh Downs out.</li>
                <li>Ammad gets a new Defense.</li>
            </ul>
        </div>
    </div>

    <div id="explanationTab" class="tab-content">
        <div class="content-section">
            <h2>How The Model V2™ Works</h2>
            <p>
                The Model V2™ uses three features to drive the prediction model:
            </p>
            <ul>
                <li><strong>Points Above Projection</strong></li>
                <li><strong>Variance</strong></li>
                <li><strong>Sleeper Projections</strong></li>
            </ul>
            <p>
                Points Above Projection and Variance are recency-weighted using <em>r<sup>2</sup></em> for use in the
                prediction model.
            </p>
        </div>
    </div>

    <script>
        // Tab switching logic
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.tab-container .tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
        }

        // Player data
        const players = {
            "Shahudit": { variance: 283, model_expected: 105, sleeper_proj: 108, hot_factor: -3.4 },
            "mehdidrissi": { variance: 123, model_expected: 111, sleeper_proj: 115, hot_factor: -4.4 },
            "umarrahman30": { variance: 97, model_expected: 114, sleeper_proj: 117, hot_factor: -3.2 },
            "xavierking4": { variance: 150, model_expected: 114, sleeper_proj: 112, hot_factor: 2.4 },
            "sahirsyed30": { variance: 170, model_expected: 115, sleeper_proj: 115, hot_factor: 0.2 },
            "SumHead": { variance: 101, model_expected: 116, sleeper_proj: 114, hot_factor: 1.8 },
            "sfaizi24": { variance: 128, model_expected: 118, sleeper_proj: 114, hot_factor: 3.5 },
            "asadrafique": { variance: 198, model_expected: 118, sleeper_proj: 116, hot_factor: 1.9 },
            "Ammady": { variance: 298, model_expected: 120, sleeper_proj: 113, hot_factor: 11.1 },
            "Jibraan": { variance: 483, model_expected: 126, sleeper_proj: 124, hot_factor: 1.7 },
            "Bilal879": { variance: 286, model_expected: 130, sleeper_proj: 125, hot_factor: 5.0 },
            "amir812": { variance: 255, model_expected: 134, sleeper_proj: 129, hot_factor: 4.6 }
        };

        // Weekly data per team
        const weeklyData = {
            "amir812": [2.5, -3.2, -5.4, -2.6, -8.2, -6.7, -12.2, 13.5, 45.2, 21.6, 5.8, 4.4],
            "Ammady": [2.4, -3.0, 0.9, 3.8, 15.2, 1.3, 16.2, 9.6, 13.8, -13.6, 41.5, 45.2],
            "asadrafique": [-0.5, 0.6, -3.9, 4.7, 0.6, 5.6, -21.3, 1.4, 8.8, -11.2, 0.0, 38.9],
            "Bilal879": [-1.0, -3.7, 0.7, -3.2, 5.7, -8.2, 10.9, 8.5, -22.8, 46.1, 5.9, 21.3],
            "Jibraan": [0.1, -2.5, 1.9, 4.2, 5.2, 14.2, 11.9, -15.8, -4.8, -23.5, 57.8, -28.1],
            "mehdidrissi": [1.5, 0.5, -6.3, 7.7, 4.1, -3.8, -26.0, 7.7, 3.3, -9.2, -9.6, -22.7],
            "sahirsyed30": [-1.8, 1.1, -3.8, -2.1, 6.8, -0.8, 4.5, 22.6, -5.5, 20.6, -24.6, -14.3],
            "sfaizi24": [-1.4, -1.4, 1.3, 2.0, 7.6, 17.2, 16.5, -4.4, -8.5, 20.6, -7.1, 27.0],
            "Shahudit": [0.5, 2.4, 12.1, 2.6, -6.8, 10.6, -7.9, 6.8, 19.4, -28.1, -38.3, 19.4],
            "SumHead": [-2.0, -0.3, 2.4, 0.4, -13.9, 0.2, 20.9, 12.1, 5.1, -15.0, 10.9, 5.1],
            "umarrahman30": [-0.5, 3.6, -1.2, -12.0, 18.5, -6.2, 3.3, -1.0, -20.5, -15.0, -6.1, -12.8],
            "xavierking4": [0.5, 6.6, -5.0, 0.3, 14.0, 2.5, -13.2, -1.5, 27.9, 7.2, 8.5, -19.3]
        };

        // Calculate the number of weeks each team was above projection
        const weeksAboveProjection = {};

        for (const team in weeklyData) {
            const positiveWeeks = weeklyData[team].filter(value => value > 0).length;
            weeksAboveProjection[team] = positiveWeeks;
        }

        // Populate dropdowns
        function populateDropdown(id) {
            const dropdown = document.getElementById(id);
            for (const player in players) {
                const option = document.createElement("option");
                option.value = player;
                option.textContent = player;
                dropdown.appendChild(option);
            }
        }

        // Calculate probability
        function calculateProbability() {
            const teamAPlayer = document.getElementById("teamA").value;
            const teamBPlayer = document.getElementById("teamB").value;

            if (teamAPlayer && teamBPlayer) {
                const teamAData = players[teamAPlayer];
                const teamBData = players[teamBPlayer];

                // Get the inputted number
                const adjustmentInput = document.getElementById("adjustment").value;
                const adjustmentNumber = parseFloat(adjustmentInput) || 0; // Defaults to 0 if empty or invalid

                // Modify the numerator
                const numerator = teamAData.model_expected - teamBData.model_expected - adjustmentNumber;
                const denominator = Math.sqrt(teamAData.variance + teamBData.variance);
                const zScore = numerator / denominator;

                // Standard normal CDF using erf function
                const probability = 0.5 * (1 + erf(zScore / Math.sqrt(2)));

                // Display the probability as a percentage
                document.getElementById("result").textContent = `Probability: ${(probability * 100).toFixed(2)}%`;
            } else {
                document.getElementById("result").textContent = "Please select both teams.";
            }
        }

        // Implement the error function (erf)
        function erf(x) {
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            const a1 = 0.254829592, a2 = -0.284496736;
            const a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429;
            const p = 0.3275911;
            const t = 1 / (1 + p * x);
            const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            return sign * y;
        }

        // Populate dropdowns immediately
        populateDropdown("teamA");
        populateDropdown("teamB");

        const playerNames = Object.keys(players);

        // Generate the first chart (Sleeper Projections vs The Model™ Expected)
        const ctx = document.getElementById("playerChart").getContext("2d");
        const sleeperProjData = playerNames.map(player => players[player].sleeper_proj);
        const modelExpectedData = playerNames.map(player => players[player].model_expected);

        new Chart(ctx, {
            type: "line",
            data: {
                labels: playerNames,
                datasets: [
                    {
                        label: "Sleeper Projections",
                        data: sleeperProjData,
                        borderColor: "#0071E3",
                        backgroundColor: "rgba(0, 113, 227, 0.1)",
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: "The Model™ Expected",
                        data: modelExpectedData,
                        borderColor: "#1D1D1F",
                        backgroundColor: "rgba(29, 29, 31, 0.1)",
                        fill: true,
                        tension: 0.3
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Allows the chart to fill the container
                plugins: {
                    title: {
                        display: true,
                        text: "The Model V2™ vs Sleeper Projections",
                        font: {
                            size: 24,
                            weight: '600'
                        },
                        color: '#1D1D1F'
                    },
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 16
                            },
                            color: '#1D1D1F'
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: "Teams",
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: "Points",
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        }
                    }
                }
            }
        });

        // Generate the variance vs expected points chart
        const varianceCtx = document.getElementById("varianceChart").getContext("2d");
        const stdDevData = playerNames.map(player => Math.sqrt(players[player].variance));

        new Chart(varianceCtx, {
            type: 'line',
            data: {
                labels: playerNames,
                datasets: [
                    {
                        label: 'The Model™ Expected',
                        data: modelExpectedData,
                        borderColor: '#1D1D1F',
                        backgroundColor: 'rgba(29, 29, 31, 0.1)',
                        yAxisID: 'y',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Volatility (√Variance)',
                        data: stdDevData,
                        borderColor: '#a12830',
                        backgroundColor: 'rgba(161, 40, 48, 0.1)',
                        yAxisID: 'y1',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Allows the chart to fill the container
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                stacked: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Recency-Weighted Volatility Per Team',
                        font: {
                            size: 24,
                            weight: '600'
                        },
                        color: '#1D1D1F'
                    },
                    legend: {
                        position: 'top',
                        labels: {
                            font: {
                                size: 16
                            },
                            color: '#1D1D1F'
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Expected Points',
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: {
                            drawOnChartArea: false, // Only want the grid lines for one axis
                        },
                        title: {
                            display: true,
                            text: 'Standard Deviation',
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Teams',
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        }
                    }
                }
            }
        });

        // Generate the Weeks Above Projection chart
        const weeksAboveCtx = document.getElementById("weeksAboveChart").getContext("2d");
        const positiveWeeksData = playerNames.map(player => weeksAboveProjection[player]);

        new Chart(weeksAboveCtx, {
            type: 'bar',
            data: {
                labels: playerNames,
                datasets: [
                    {
                        label: 'Weeks Scored Above Projection',
                        data: positiveWeeksData,
                        backgroundColor: '#0071E3',
                        borderColor: '#1D1D1F',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Weeks Above Projection',
                        font: {
                            size: 24,
                            weight: '600'
                        },
                        color: '#1D1D1F'
                    },
                    legend: {
                        display: false // Hide legend since there's only one dataset
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Teams',
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Number of Weeks',
                            font: {
                                size: 18,
                                weight: '600'
                            },
                            color: '#1D1D1F'
                        },
                        ticks: {
                            stepSize: 1,
                            font: {
                                size: 14
                            },
                            color: '#1D1D1F'
                        },
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>

</html>
