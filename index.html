<!DOCTYPE html>
<html>

<head>
    <title>TNC The Model™ V2 Week 13 Predictions</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Basic styles for tabs */
        .tab-container {
            display: flex;
            margin-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-bottom: none;
            background-color: #f9f9f9;
        }

        .tab.active {
            background-color: #fff;
            font-weight: bold;
        }

        .tab-content {
            border: 1px solid #ccc;
            padding: 20px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <h1>TNC The Model™ V2 Week 13 Predictions</h1>

    <!-- Tab navigation -->
    <div class="tab-container">
        <div class="tab active" onclick="switchTab('chartTab')">Prediction Model and Charts</div>
        <div class="tab" onclick="switchTab('bulletTab')">Roster Changes</div>
        <div class="tab" onclick="switchTab('explanationTab')">How The Model Works</div>
    </div>

    <!-- Tab content -->
    <div id="chartTab" class="tab-content active">
        <label for="teamA">Select Winning Team:</label>
        <select id="teamA">
            <option value="">-- Select a Team --</option>
        </select>

        <br><br>

        <label for="teamB">Select Losing Team:</label>
        <select id="teamB">
            <option value="">-- Select a Team --</option>
        </select>

        <br><br>

        <label for="adjustment">Win By (optional):</label>
        <input type="number" id="adjustment" step="any">

        <br><br>

        <button onclick="calculateProbability()">Calculate</button>

        <h2 id="result"></h2>

        <canvas id="playerChart" width="600" height="300"></canvas>
    </div>

    <div id="bulletTab" class="tab-content">
        <h2>Assumptions Made</h2>
        <ul>
            <li>Projection data taken from Wednesday, Nov 27th snapshot</li>
            <li>Mehdi has JK Dobbins Out.</li>
            <li>Sumedh gets Pacheco back</li>
            <li>Umar gets a new TE and Kicker</li>
            <li>Dany starts Burrow and Davante</li>
            <li>Samer has Josh Downs out</li>
        </ul>
    </div>

    <div id="explanationTab" class="tab-content">
        <h2>How The Model V2™ Works</h2>
        <p>
            The Model V2™ calculates recency-weighted points above projection to calculate a Hot-Factor. 
            The Hot-Factor is then used to calculate Expected Points. 
            The Model V2™ also calculates recency-weighted variance, 
            used to determine which teams are more or less explosive.
        </p>
    </div>

    <script>
        // Tab switching logic
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
        }

        // Player data
        const players = {
            "Shahudit": { variance: 283, model_expected: 105, sleeper_proj: 108, hot_factor: -3.4 },
            "mehdidrissi": { variance: 123, model_expected: 111, sleeper_proj: 115, hot_factor: -4.4 },
            "umarrahman30": { variance: 97, model_expected: 114, sleeper_proj: 117, hot_factor: -3.2 },
            "xavierking4": { variance: 150, model_expected: 114, sleeper_proj: 112, hot_factor: 2.4 },
            "sahirsyed30": { variance: 170, model_expected: 115, sleeper_proj: 115, hot_factor: 0.2 },
            "SumHead": { variance: 101, model_expected: 116, sleeper_proj: 114, hot_factor: 1.8 },
            "sfaizi24": { variance: 128, model_expected: 118, sleeper_proj: 114, hot_factor: 3.5 },
            "asadrafique": { variance: 198, model_expected: 118, sleeper_proj: 116, hot_factor: 1.9 },
            "Ammady": { variance: 298, model_expected: 120, sleeper_proj: 109, hot_factor: 11.1 },
            "Jibraan": { variance: 483, model_expected: 126, sleeper_proj: 124, hot_factor: 1.7 },
            "Bilal879": { variance: 286, model_expected: 130, sleeper_proj: 125, hot_factor: 5.0 },
            "amir812": { variance: 255, model_expected: 134, sleeper_proj: 129, hot_factor: 4.6 }
        };

        // Populate dropdowns
        function populateDropdown(id) {
            const dropdown = document.getElementById(id);
            for (const player in players) {
                const option = document.createElement("option");
                option.value = player;
                option.textContent = player;
                dropdown.appendChild(option);
            }
        }

        // Calculate probability
        function calculateProbability() {
            const teamAPlayer = document.getElementById("teamA").value;
            const teamBPlayer = document.getElementById("teamB").value;

            if (teamAPlayer && teamBPlayer) {
                const teamAData = players[teamAPlayer];
                const teamBData = players[teamBPlayer];

                // Get the inputted number
                const adjustmentInput = document.getElementById("adjustment").value;
                const adjustmentNumber = parseFloat(adjustmentInput) || 0; // Defaults to 0 if empty or invalid

                // Modify the numerator
                const numerator = teamAData.model_expected - teamBData.model_expected - adjustmentNumber;
                const denominator = Math.sqrt(teamAData.variance + teamBData.variance);
                const zScore = numerator / denominator;

                // Standard normal CDF using erf function
                const probability = 0.5 * (1 + erf(zScore / Math.sqrt(2)));

                // Display the probability as a percentage
                document.getElementById("result").textContent = `Probability: ${(probability * 100).toFixed(2)}%`;
            } else {
                document.getElementById("result").textContent = "Please select both players.";
            }
        }

        // Implement the error function (erf)
        function erf(x) {
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            const a1 = 0.254829592, a2 = -0.284496736;
            const a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429;
            const p = 0.3275911;
            const t = 1 / (1 + p * x);
            const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            return sign * y;
        }

        // Populate dropdowns immediately
        populateDropdown("teamA");
        populateDropdown("teamB");

        // Generate the line graph
        const ctx = document.getElementById("playerChart").getContext("2d");
        const playerNames = Object.keys(players);
        const sleeperProjData = playerNames.map(player => players[player].sleeper_proj);
        const modelExpectedData = playerNames.map(player => players[player].model_expected);

        new Chart(ctx, {
            type: "line",
            data: {
                labels: playerNames,
                datasets: [
                    {
                        label: "Sleeper Projections",
                        data: sleeperProjData,
                        borderColor: "#003a6f",
                        fill: false
                    },
                    {
                        label: "The Model™ Expected",
                        data: modelExpectedData,
                        borderColor: "#a12830",
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: "The Model V2™ vs Sleeper Projections"
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: "Teams"
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: "Points
