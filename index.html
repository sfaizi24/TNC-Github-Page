<!DOCTYPE html>
<html>
<head>
    <title>TNC Week 13 Calculator</title>
</head>
<body>
    <h1>TNC Week 13 Calculator</h1>

    <label for="teamA">Select Winning Team:</label>
    <select id="teamA">
        <option value="">-- Select a player --</option>
    </select>

    <br><br>

    <label for="teamB">Select Losing Team:</label>
    <select id="teamB">
        <option value="">-- Select a player --</option>
    </select>

    <br><br>

    <label for="adjustment">Win By (optional):</label>
    <input type="number" id="adjustment" step="any">

    <br><br>

    <button onclick="calculateProbability()">Calculate</button>

    <h2 id="result"></h2>

    <!-- JavaScript code at the end of the body -->
    <script>
        // Player data
        const players = {
            "Shahudit": { variance: 283, model_expected: 104.68 },
            "mehdidrissi": { variance: 123, model_expected: 110.63 },
            "umarrahman30": { variance: 97, model_expected: 113.84 },
            "xavierking4": { variance: 150, model_expected: 113.99 },
            "sahirsyed30": { variance: 170, model_expected: 115.16 },
            "SumHead": { variance: 101, model_expected: 116.12 },
            "sfaizi24": { variance: 128, model_expected: 117.50 },
            "asadrafique": { variance: 198, model_expected: 117.91 },
            "Ammady": { variance: 298, model_expected: 120.09 },
            "Jibraan": { variance: 483, model_expected: 125.50 },
            "Bilal879": { variance: 286, model_expected: 129.78 },
            "amir812": { variance: 255, model_expected: 133.61 }
        };

        // Populate dropdowns
        function populateDropdown(id) {
            const dropdown = document.getElementById(id);
            for (const player in players) {
                const option = document.createElement("option");
                option.value = player;
                option.textContent = player;
                dropdown.appendChild(option);
            }
        }

        // Calculate probability
        function calculateProbability() {
            const teamAPlayer = document.getElementById("teamA").value;
            const teamBPlayer = document.getElementById("teamB").value;

            if (teamAPlayer && teamBPlayer) {
                const teamAData = players[teamAPlayer];
                const teamBData = players[teamBPlayer];

                // Get the inputted number
                const adjustmentInput = document.getElementById("adjustment").value;
                const adjustmentNumber = parseFloat(adjustmentInput) || 0; // Defaults to 0 if empty or invalid

                // Modify the numerator
                const numerator = teamAData.model_expected - teamBData.model_expected - adjustmentNumber;
                const denominator = Math.sqrt(teamAData.variance + teamBData.variance);
                const zScore = numerator / denominator;

                // Standard normal CDF using erf function
                const probability = 0.5 * (1 + erf(zScore / Math.sqrt(2)));

                // Display the probability as a percentage
                document.getElementById("result").textContent = `Probability: ${(probability * 100).toFixed(2)}%`;
            } else {
                document.getElementById("result").textContent = "Please select both players.";
            }
        }

        // Implement the error function (erf)
        function erf(x) {
            // Approximation of error function
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            const a1 = 0.254829592, a2 = -0.284496736;
            const a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429;
            const p = 0.3275911;
            const t = 1 / (1 + p * x);
            const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            return sign * y;
        }

        // Populate dropdowns immediately since elements are loaded
        populateDropdown("teamA");
        populateDropdown("teamB");
    </script>
</body>
</html>
